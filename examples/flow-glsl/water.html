<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>mushu â€” Flow Water Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    body {
      background: #000;
      overflow: hidden;
    }

    .info {
      position: fixed;
      top: 10px;
      left: 10px;
      color: #fff;
      font: 14px monospace;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 16px;
      border-radius: 6px;
      z-index: 100;
    }

    .info code {
      color: #00bbdd;
    }

    .home-link {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #ff6b6b, #feca57);
      color: #000;
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      font-size: 0.85rem;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
      transition: all 0.2s;
      z-index: 100;
      font-family: monospace;
    }

    .home-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    }

    .home-link.hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div class="info">ğŸŒŠ <code>mushu().gl().flow()</code> Water | Move mouse to interact</div>
  <canvas id="c" style="position:fixed;inset:0;width:100%;height:100%"></canvas>
  <script type="module">
    import { mushu, shader, fps } from '../../src/index.js';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // YO Water - Procedural Gerstner Waves (WebGL2)
    // 
    // Features:
    //   â€¢ Multiple Gerstner wave layers
    //   â€¢ FBM turbulent detail
    //   â€¢ Fresnel reflections with sky gradient
    //   â€¢ Sun specular highlights
    //   â€¢ Animated caustics pattern
    //   â€¢ Foam on wave crests
    //   â€¢ Subsurface scattering
    // 
    // Move mouse to create ripples!
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // Move mouse to disturb the water!
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    mushu('#c').gl()
      .use(shader(`
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Noise Functions
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    float hash(vec2 p) {
      return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
    }
    
    float noise(vec2 p) {
      vec2 i = floor(p);
      vec2 f = fract(p);
      f = f * f * (3.0 - 2.0 * f);
      return mix(
        mix(hash(i), hash(i + vec2(1,0)), f.x),
        mix(hash(i + vec2(0,1)), hash(i + vec2(1,1)), f.x),
        f.y
      );
    }
    
    float fbm(vec2 p) {
      float f = 0.0;
      float amp = 0.5;
      mat2 rot = mat2(0.8, 0.6, -0.6, 0.8);
      for (int i = 0; i < 5; i++) {
        f += amp * noise(p);
        p = rot * p * 2.0;
        amp *= 0.5;
      }
      return f;
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Gerstner Wave Function
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    vec3 gerstnerWave(vec2 p, vec2 dir, float steepness, float wavelength, float t) {
      float k = 6.28318 / wavelength;
      float c = sqrt(9.8 / k);
      float a = steepness / k;
      float f = k * (dot(dir, p) - c * t);
      return vec3(dir.x * a * cos(f), a * sin(f), dir.y * a * cos(f));
    }
    
    void mainImage(out vec4 O, vec2 C) {
      vec2 uv = C / resolution;
      vec2 p = (C - resolution * 0.5) / resolution.y;
      float t = time * 0.5;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Mouse Interaction
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      vec2 mouseP = mouse - 0.5;
      mouseP.x *= resolution.x / resolution.y;
      float mouseDist = length(p - mouseP);
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Gerstner Wave Layers
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      vec3 wave = vec3(0.0);
      wave += gerstnerWave(p * 5.0, normalize(vec2(1.0, 0.3)), 0.15, 0.8, t);
      wave += gerstnerWave(p * 5.0, normalize(vec2(-0.5, 0.8)), 0.12, 0.6, t * 1.1);
      wave += gerstnerWave(p * 8.0, normalize(vec2(0.7, -0.5)), 0.08, 0.4, t * 1.3);
      wave += gerstnerWave(p * 12.0, normalize(vec2(-0.3, -0.7)), 0.05, 0.25, t * 1.5);
      
      // Add turbulent detail
      float detail = fbm(p * 8.0 + t * 0.2) * 0.1;
      wave.y += detail;
      
      // Mouse creates local disturbance
      float mouseRipple = sin(mouseDist * 40.0 - t * 8.0) * exp(-mouseDist * 6.0) * 0.15;
      wave.y += mouseRipple;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Normal Calculation
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      float eps = 0.01;
      vec3 wave_dx = gerstnerWave((p + vec2(eps, 0)) * 5.0, normalize(vec2(1.0, 0.3)), 0.15, 0.8, t)
                   + gerstnerWave((p + vec2(eps, 0)) * 5.0, normalize(vec2(-0.5, 0.8)), 0.12, 0.6, t * 1.1);
      vec3 wave_dy = gerstnerWave((p + vec2(0, eps)) * 5.0, normalize(vec2(1.0, 0.3)), 0.15, 0.8, t)
                   + gerstnerWave((p + vec2(0, eps)) * 5.0, normalize(vec2(-0.5, 0.8)), 0.12, 0.6, t * 1.1);
      
      vec3 normal = normalize(vec3(
        (wave.y - wave_dx.y) * 10.0,
        1.0,
        (wave.y - wave_dy.y) * 10.0
      ));
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Lighting Setup
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      vec3 viewDir = vec3(0.0, 1.0, 0.0);
      vec3 lightDir = normalize(vec3(0.3, 0.8, 0.5));
      
      // Fresnel
      float fresnel = pow(1.0 - max(0.0, dot(viewDir, normal)), 4.0);
      fresnel = 0.15 + 0.85 * fresnel;
      
      // Reflection
      vec3 reflDir = reflect(-viewDir, normal);
      float skyGradient = reflDir.y * 0.5 + 0.5;
      vec3 skyColor = mix(
        vec3(0.7, 0.8, 0.95),
        vec3(0.4, 0.6, 0.9),
        pow(skyGradient, 0.6)
      );
      
      // Sun specular
      float sunSpec = pow(max(0.0, dot(reflDir, lightDir)), 200.0);
      vec3 sunColor = vec3(1.0, 0.95, 0.9) * sunSpec * 4.0;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Water Colors & Caustics
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      vec3 waterDeep = vec3(0.01, 0.05, 0.12);
      vec3 waterShallow = vec3(0.08, 0.2, 0.3);
      float depth = 0.5 + wave.y * 3.0;
      vec3 waterColor = mix(waterDeep, waterShallow, clamp(depth, 0.0, 1.0));
      
      // Caustics
      float caustic1 = sin((p.x + normal.x) * 30.0 + t * 2.0) * sin((p.y + normal.z) * 30.0 + t * 1.5);
      float caustic2 = sin((p.x - normal.x) * 20.0 - t * 1.5) * sin((p.y - normal.z) * 25.0 + t * 2.0);
      float caustics = pow((caustic1 + caustic2) * 0.5 + 0.5, 4.0) * 0.2;
      waterColor += vec3(0.2, 0.3, 0.4) * caustics;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Final Composition
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      vec3 col = mix(waterColor, skyColor, fresnel * 0.7);
      col += sunColor;
      
      // Foam on wave crests
      float foam = smoothstep(0.08, 0.15, wave.y);
      col = mix(col, vec3(0.95, 0.98, 1.0), foam * 0.5);
      
      // Subsurface scattering
      float sss = pow(max(0.0, dot(lightDir, -normal)), 2.0) * 0.1;
      col += vec3(0.1, 0.3, 0.4) * sss;
      
      // Tone mapping
      col = 1.0 - exp(-col * 1.2);
      col = pow(col, vec3(0.95));
      
      // Vignette
      float vignette = 1.0 - length(uv - 0.5) * 0.25;
      col *= vignette;
      
      O = vec4(col, 1.0);
    }
  `))
      .use(fps())
      .go();

    console.log('%c ğŸŒŠ mushu Flow Water Ready ', 'background: linear-gradient(90deg, #0066aa, #00bbdd); color: white; padding: 8px 16px; border-radius: 4px; font-weight: bold;');
    console.log('Move mouse to create ripples!');
  </script>
  <script>
    // Hide home-link if in iframe - run immediately and on load
    function hideIfIframe() {
      if (window.self !== window.top) {
        const link = document.querySelector('.home-link');
        if (link) {
          link.style.display = 'none';
        }
      }
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', hideIfIframe);
    } else {
      hideIfIframe();
    }
  </script>
  <a href="index.html" class="home-link">â† Back to Index</a>
</body>

</html>