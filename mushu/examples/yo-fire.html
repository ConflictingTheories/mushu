<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>mushu â€” YO Fire Demo</title>
  <style>body{margin:0;overflow:hidden;background:#000}</style>
</head>
<body>
<canvas id="c" style="position:fixed;inset:0;width:100%;height:100%"></canvas>
<script type="module">
import { yo, simulation, fps } from '../src/core/yo.js';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// YO Fire Simulation (WebGL2)
// Features: Fuel consumption, heat diffusion, turbulence, smoke generation
// Hold & drag mouse to add fuel and ignite flames!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const sim = simulation({ scale: 0.5, iterations: 2 });

sim.simulate(`
  float hash(vec2 p) {
    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
  }
  
  float noise(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    f = f * f * (3.0 - 2.0 * f);
    return mix(
      mix(hash(i), hash(i + vec2(1,0)), f.x),
      mix(hash(i + vec2(0,1)), hash(i + vec2(1,1)), f.x),
      f.y
    );
  }

  void mainImage(out vec4 O, vec2 C) {
    vec2 uv = C / resolution;
    vec4 data = sample(vec2(0));
    
    float fuel = data.r;
    float heat = data.g;
    float smoke = data.b;
    
    vec4 up = sample(vec2(0, 1));
    vec4 down = sample(vec2(0, -1));
    vec4 left = sample(vec2(-1, 0));
    vec4 right = sample(vec2(1, 0));
    
    float turb = noise(uv * 20.0 + time * 2.0) * 2.0 - 1.0;
    vec4 turbLeft = sample(vec2(-1.0 + turb * 0.5, 0));
    vec4 turbRight = sample(vec2(1.0 + turb * 0.5, 0));
    
    float diffusion = 0.15;
    heat += diffusion * (up.g + down.g + left.g + right.g - 4.0 * heat);
    
    float buoyancy = 0.25 + heat * 0.1;
    heat = mix(heat, down.g, buoyancy);
    heat = mix(heat, (turbLeft.g + turbRight.g) * 0.5, 0.08);
    
    fuel = mix(fuel, down.r, 0.1);
    fuel += 0.03 * (up.r + down.r + left.r + right.r - 4.0 * fuel);
    
    float ignitionTemp = 0.3;
    if (heat > ignitionTemp && fuel > 0.01) {
      float combustion = min(fuel, (heat - ignitionTemp) * 0.8);
      heat += combustion * 1.2;
      fuel -= combustion;
      smoke += combustion * 0.6;
    }
    
    fuel *= 0.985;
    heat *= 0.975;
    smoke *= 0.995;
    
    smoke = mix(smoke, down.b, 0.08);
    smoke += 0.02 * (left.b + right.b - 2.0 * smoke);
    
    float d = length(uv - mouse);
    if (mouseDown > 0.5 && d < 0.1) {
      float intensity = pow(1.0 - d / 0.1, 2.0);
      fuel += intensity * 6.0;
      heat += intensity * 3.0;
    }
    
    if (uv.y < 0.12) {
      float edge = 1.0 - uv.y / 0.12;
      float p1 = sin(uv.x * 25.0 + time * 3.0) * 0.5 + 0.5;
      float p2 = sin(uv.x * 8.0 - time * 1.5) * 0.5 + 0.5;
      float p3 = noise(vec2(uv.x * 50.0, time * 5.0));
      float pattern = p1 * p2 * (0.5 + p3 * 0.5);
      
      if (pattern > 0.25) {
        float intensity = pattern * edge * 2.0;
        fuel += intensity * 1.5;
        heat += intensity * 2.5;
      }
    }
    
    O = vec4(
      clamp(fuel, 0.0, 20.0),
      clamp(heat, 0.0, 20.0),
      clamp(smoke, 0.0, 15.0),
      1.0
    );
  }
`);

sim.display(`
  void mainImage(out vec4 O, vec2 C) {
    vec2 uv = C / resolution;
    vec4 data = texture(backbuffer, uv);
    
    float fuel = data.r;
    float heat = data.g;
    float smoke = data.b;
    
    vec3 color = vec3(0.0);
    
    color += vec3(1.0, 1.0, 1.0) * pow(heat, 4.0) * 3.0;
    color += vec3(1.0, 0.95, 0.7) * pow(heat, 3.0) * 2.5;
    color += vec3(1.0, 0.6, 0.1) * pow(heat, 2.0) * 2.0;
    color += vec3(1.0, 0.25, 0.0) * pow(heat, 1.2) * 1.5;
    color += vec3(0.6, 0.05, 0.0) * pow(heat, 0.6) * 0.8;
    
    float embers = fuel * (1.0 - heat * 0.15);
    color += vec3(1.0, 0.3, 0.0) * embers * 0.5;
    
    vec3 smokeColor = vec3(0.03, 0.03, 0.04);
    float smokeOpacity = 1.0 - exp(-smoke * 0.3);
    color = mix(color, smokeColor, smokeOpacity * 0.85);
    
    color = 1.0 - exp(-color * 0.6);
    color = pow(color, vec3(0.92));
    
    O = vec4(color, 1.0);
  }
`);

yo(document.getElementById('c'))
  .scale(1)
  .use(sim)
  .use(fps())
  .go();

console.log('%c ðŸ”¥ mushu YO Fire Ready ', 'background: linear-gradient(90deg, #ff4500, #ff8c00); color: white; padding: 8px 16px; border-radius: 4px; font-weight: bold;');
console.log('Hold & drag mouse to ignite flames!');
</script>
</body>
</html>
