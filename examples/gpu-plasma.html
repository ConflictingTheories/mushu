<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>mushu â€” WebGPU Plasma Demo</title>
  <style>
    * { margin: 0; padding: 0; }
    body { background: #000; overflow: hidden; }
    .info { position: fixed; top: 10px; left: 10px; color: #fff; font: 14px monospace; 
            background: rgba(0,0,0,0.7); padding: 10px 16px; border-radius: 6px; z-index: 100; }
    .info code { color: #ff44ff; }
  </style>
</head>
<body>
<div class="info">âš¡ <code>gpu(compute, render)</code> Plasma | WebGPU Function API</div>
<canvas id="c" style="position:fixed;inset:0;width:100%;height:100%"></canvas>
<script type="module">
import { gpu } from '../src/gpu/yoGPU.js';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WebGPU Advanced Plasma Effect
// 
// Features:
//   â€¢ Multi-frequency sinusoidal interference patterns
//   â€¢ Perlin noise-based distortion
//   â€¢ Dynamic color palette with gradient shifts
//   â€¢ Mouse-interactive energy waves
//   â€¢ Bloom and glow effects
//   â€¢ Pulsing energy core
// 
// Move mouse to influence the plasma! Click for energy burst!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

gpu(
  // Compute shader - Plasma state
  /* wgsl */`
    fn hash(p: vec2<f32>) -> f32 {
      return fract(sin(dot(p, vec2<f32>(127.1, 311.7))) * 43758.5453);
    }
    
    fn noise(p: vec2<f32>) -> f32 {
      let i = floor(p);
      let f = fract(p);
      let u = f * f * (3.0 - 2.0 * f);
      return mix(
        mix(hash(i), hash(i + vec2<f32>(1.0, 0.0)), u.x),
        mix(hash(i + vec2<f32>(0.0, 1.0)), hash(i + vec2<f32>(1.0, 1.0)), u.x),
        u.y
      ) * 2.0 - 1.0;
    }
    
    fn fbm(p: vec2<f32>, octaves: i32) -> f32 {
      var value = 0.0;
      var amplitude = 0.5;
      var pos = p;
      let rot = mat2x2<f32>(0.8, 0.6, -0.6, 0.8);
      for (var i = 0; i < 5; i++) {
        if (i >= octaves) { break; }
        value += amplitude * noise(pos);
        pos = rot * pos * 2.0;
        amplitude *= 0.5;
      }
      return value;
    }

    fn compute(C: vec2<i32>, uv: vec2<f32>) {
      // Aspect-correct coordinates
      let aspect = u.width / u.height;
      var p = (uv - 0.5) * vec2<f32>(aspect, 1.0);
      let t = u.time * 0.5;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Mouse Interaction - Warp Space
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      let mouseP = (vec2<f32>(u.mouseX, u.mouseY) - 0.5) * vec2<f32>(aspect, 1.0);
      let mouseDist = length(p - mouseP);
      
      // Warp space toward mouse
      p += normalize(p - mouseP + vec2<f32>(0.001)) * (1.0 / (mouseDist * 5.0 + 1.0)) * 0.08;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Noise Distortion
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      let distort = vec2<f32>(
        fbm(p * 3.0 + t * 0.3, 4),
        fbm(p * 3.0 + t * 0.3 + 100.0, 4)
      );
      p += distort * 0.12;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Multi-frequency Plasma Waves
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      var v = 0.0;
      
      // Primary waves
      v += sin(p.x * 10.0 + t * 1.2);
      v += sin(p.y * 12.0 + t * 0.9);
      v += sin((p.x + p.y) * 8.0 + t * 0.7);
      v += sin(length(p) * 15.0 - t * 2.5);
      
      // Rotated secondary waves
      let rotP = mat2x2<f32>(0.866, 0.5, -0.5, 0.866) * p;
      v += sin(rotP.x * 8.0 + sin(rotP.y * 4.0 + t) * 2.0) * 0.7;
      v += sin(rotP.y * 9.0 + sin(rotP.x * 3.0 - t * 0.5) * 2.0) * 0.7;
      
      // Moving circular wave centers
      let c1 = vec2<f32>(sin(t * 0.3) * 0.5, cos(t * 0.4) * 0.5);
      let c2 = vec2<f32>(cos(t * 0.5) * 0.4, sin(t * 0.35) * 0.6);
      let c3 = vec2<f32>(sin(t * 0.25 + 2.0) * 0.6, cos(t * 0.45 + 1.0) * 0.4);
      
      v += sin(length(p - c1) * 12.0 - t * 2.0) * 0.8;
      v += sin(length(p - c2) * 10.0 + t * 1.5) * 0.6;
      v += sin(length(p - c3) * 14.0 - t * 1.8) * 0.5;
      
      // High-frequency detail
      v += fbm(p * 8.0 + t, 4) * 0.6;
      
      v *= 0.12;
      
      // Store plasma value and mouse info
      let glow = select(0.0, 1.0, u.mouseDown > 0.5);
      
      textureStore(dst, C, vec4<f32>(v, u.mouseX, u.mouseY, glow));
    }
  `,
  
  // Render shader - Advanced plasma coloring
  /* wgsl */`
    fn palette(t: f32, a: vec3<f32>, b: vec3<f32>, c: vec3<f32>, d: vec3<f32>) -> vec3<f32> {
      return a + b * cos(6.28318 * (c * t + d));
    }

    fn render(data: vec4<f32>, uv: vec2<f32>) -> vec4<f32> {
      let v = data.r;
      let mouseX = data.g;
      let mouseY = data.b;
      let glow = data.a;
      let t = u.time * 0.3;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Dynamic Color Palette
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      let col1 = palette(v + t * 0.1,
        vec3<f32>(0.5, 0.5, 0.5),
        vec3<f32>(0.5, 0.5, 0.5),
        vec3<f32>(1.0, 1.0, 1.0),
        vec3<f32>(0.0, 0.33, 0.67)
      );
      
      let col2 = palette(v + t * 0.15 + 0.5,
        vec3<f32>(0.5, 0.5, 0.5),
        vec3<f32>(0.5, 0.5, 0.5),
        vec3<f32>(1.0, 0.7, 0.4),
        vec3<f32>(0.0, 0.15, 0.2)
      );
      
      let blend = sin(t * 0.5) * 0.5 + 0.5;
      var col = mix(col1, col2, blend);
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Energy Core
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      let aspect = u.width / u.height;
      let p = (uv - 0.5) * vec2<f32>(aspect, 1.0);
      
      let core = exp(-length(p) * 3.0);
      let pulse = sin(u.time * 4.0) * 0.3 + 0.7;
      col += vec3<f32>(1.0, 0.9, 0.7) * core * pulse * 0.5;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Mouse Glow
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      let mouseP = (vec2<f32>(mouseX, mouseY) - 0.5) * vec2<f32>(aspect, 1.0);
      let mouseDist = length(p - mouseP);
      
      let mouseGlow = exp(-mouseDist * 4.0);
      let mouseColor = palette(v + mouseDist * 2.0, 
        vec3<f32>(0.5), vec3<f32>(0.5), vec3<f32>(1.0, 0.7, 0.4), vec3<f32>(0.3, 0.2, 0.2));
      col = mix(col, mouseColor * 1.5, mouseGlow * 0.5);
      
      // Energy burst on click
      if (glow > 0.5) {
        let burst = sin(mouseDist * 30.0 - u.time * 10.0);
        let burstIntensity = pow(max(burst, 0.0), 2.0);
        let burstFade = exp(-mouseDist * 3.0);
        col += vec3<f32>(1.0, 0.8, 0.6) * burstIntensity * burstFade * 2.0;
        
        // Ripple waves
        let ripple = sin(mouseDist * 50.0 - u.time * 15.0);
        let rippleIntensity = smoothstep(0.7, 1.0, ripple);
        col += vec3<f32>(1.0, 0.9, 0.8) * rippleIntensity * burstFade;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Bloom
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      let luminance = dot(col, vec3<f32>(0.299, 0.587, 0.114));
      let bloom = pow(max(luminance - 0.5, 0.0) * 2.0, 2.0);
      col += col * bloom * 0.3;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Final Adjustments
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      // Vignette
      let vignette = 1.0 - length(uv - 0.5) * 0.5;
      let vignetteSmooth = smoothstep(0.0, 1.0, vignette);
      col *= vignetteSmooth;
      
      // Contrast and color grading
      col = pow(col, vec3<f32>(0.95));
      col = mix(col, col * vec3<f32>(1.05, 1.0, 0.95), 0.3);
      
      return vec4<f32>(col, 1.0);
    }
  `,
  { canvas: document.getElementById('c'), scale: 1.0 }
);

// FPS Counter
(function() {
  const fpsDiv = document.createElement('div');
  fpsDiv.style.cssText = 'position:fixed;bottom:10px;left:10px;color:white;font:14px monospace;background:rgba(0,0,0,0.6);padding:6px 12px;border-radius:4px;z-index:10000';
  document.body.appendChild(fpsDiv);
  let frames = 0, lastTime = performance.now();
  function updateFPS() {
    frames++;
    const now = performance.now();
    if (now - lastTime >= 500) {
      fpsDiv.textContent = Math.round(frames * 1000 / (now - lastTime)) + ' fps';
      frames = 0; lastTime = now;
    }
    requestAnimationFrame(updateFPS);
  }
  updateFPS();
})();

console.log('%c ğŸŒˆ mushu WebGPU Plasma Ready ', 'background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff); color: white; padding: 8px 16px; border-radius: 4px; font-weight: bold;');
console.log('Move mouse to influence plasma. Click for energy burst!');
</script>
</body>
</html>
