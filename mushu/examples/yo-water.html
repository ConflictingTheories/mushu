<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>mushu â€” YO Water Demo</title>
  <style>body{margin:0;overflow:hidden;background:#000}</style>
</head>
<body>
<canvas id="c" style="position:fixed;inset:0;width:100%;height:100%"></canvas>
<script type="module">
import { yo, simulation, fps } from '../src/core/yo.js';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// YO Water Ripples (WebGL2)
// Wave equation simulation with Fresnel reflections
// Click and drag to create ripples!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const sim = simulation({ scale: 0.5, iterations: 2 });

sim.simulate(`
  void mainImage(out vec4 O, vec2 C) {
    vec2 uv = C / resolution;
    vec4 data = sample(vec2(0));
    
    vec4 up = sample(vec2(0, 1));
    vec4 down = sample(vec2(0, -1));
    vec4 left = sample(vec2(-1, 0));
    vec4 right = sample(vec2(1, 0));
    
    // R = height, G = velocity
    float height = data.r;
    float velocity = data.g;
    
    // Wave equation
    float laplacian = (up.r + down.r + left.r + right.r) * 0.25 - height;
    velocity += laplacian * 0.45;
    velocity *= 0.995; // Damping
    height += velocity;
    
    // Mouse ripples
    float d = length(uv - mouse);
    if (mouseDown > 0.5 && d < 0.05) {
      height += (1.0 - d / 0.05) * 0.4;
    }
    
    // Random raindrops
    float rnd = fract(sin(dot(C + time * 100.0, vec2(12.9898, 78.233))) * 43758.5453);
    if (rnd > 0.9999) {
      height += 0.25;
    }
    
    O = vec4(height, velocity, 0.0, 1.0);
  }
`);

sim.display(`
  void mainImage(out vec4 O, vec2 C) {
    vec2 uv = C / resolution;
    vec2 px = 1.0 / resolution;
    
    // Sample for normals
    float h = texture(backbuffer, uv).r;
    float hL = texture(backbuffer, uv - vec2(px.x, 0)).r;
    float hR = texture(backbuffer, uv + vec2(px.x, 0)).r;
    float hD = texture(backbuffer, uv - vec2(0, px.y)).r;
    float hU = texture(backbuffer, uv + vec2(0, px.y)).r;
    
    vec3 normal = normalize(vec3(
      (hL - hR) * 10.0,
      (hD - hU) * 10.0,
      1.0
    ));
    
    vec3 viewDir = vec3(0.0, 0.0, 1.0);
    vec3 lightDir = normalize(vec3(0.3, 0.5, 0.8));
    
    float fresnel = pow(1.0 - max(dot(normal, viewDir), 0.0), 3.0);
    
    vec3 halfDir = normalize(lightDir + viewDir);
    float spec = pow(max(dot(normal, halfDir), 0.0), 64.0);
    
    vec3 deepColor = vec3(0.02, 0.08, 0.18);
    vec3 shallowColor = vec3(0.1, 0.35, 0.5);
    vec3 skyColor = vec3(0.7, 0.85, 0.95);
    
    float depth = 0.5 + h * 0.3;
    vec3 color = mix(deepColor, shallowColor, depth);
    color = mix(color, skyColor, fresnel * 0.5);
    color += vec3(1.0) * spec * 0.8;
    
    // Caustics
    float caustic = sin(uv.x * 40.0 + h * 10.0) * sin(uv.y * 40.0 + h * 8.0);
    color += vec3(0.1, 0.15, 0.2) * (caustic * 0.5 + 0.5) * 0.15;
    
    O = vec4(color, 1.0);
  }
`);

yo(document.getElementById('c'))
  .scale(1)
  .use(sim)
  .use(fps())
  .go();

console.log('%c ðŸŒŠ mushu YO Water Ready ', 'background: linear-gradient(90deg, #0077be, #00bcd4); color: white; padding: 8px 16px; border-radius: 4px; font-weight: bold;');
console.log('Click and drag to create ripples!');
</script>
</body>
</html>
