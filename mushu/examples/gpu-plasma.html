<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>mushu â€” WebGPU Plasma Demo</title>
  <style>body{margin:0;overflow:hidden;background:#000}</style>
</head>
<body>
<canvas id="c" style="position:fixed;inset:0;width:100%;height:100%"></canvas>
<script type="module">
import { gpu } from '../src/gpu/yoGPU.js';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WebGPU Plasma Effect
// Classic demo-scene plasma with modern WGSL
// Move mouse to influence the colors!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

gpu(
  // Compute shader - Store plasma values in state
  /* wgsl */`
    fn compute(C: vec2<i32>, uv: vec2<f32>) {
      // Aspect-correct coordinates
      let aspect = u.width / u.height;
      let p = (uv - 0.5) * vec2<f32>(aspect, 1.0);
      let t = u.time * 0.5;
      
      // Mouse influence
      let mouseInfluence = (vec2<f32>(u.mouseX, u.mouseY) - 0.5) * 0.4;
      let q = p + mouseInfluence;
      
      // Classic plasma patterns
      var v = 0.0;
      
      // Sine wave interference
      v += sin(q.x * 10.0 + t);
      v += sin(q.y * 10.0 + t * 0.7);
      v += sin((q.x + q.y) * 10.0 + t * 0.5);
      v += sin(sqrt(q.x * q.x + q.y * q.y + 1.0) * 12.0 - t * 1.5);
      
      // Circular waves from center
      let cx = q.x + 0.5 * sin(t * 0.3);
      let cy = q.y + 0.5 * cos(t * 0.4);
      v += sin(sqrt(cx * cx + cy * cy + 1.0) * 10.0 + t);
      
      // Additional complexity
      v += sin(q.x * 5.0 + sin(q.y * 3.0 + t) * 2.0);
      
      v *= 0.25;
      
      // Store v and some mouse-related values for rendering
      let glow = select(0.0, 1.0, u.mouseDown > 0.5);
      
      textureStore(dst, C, vec4<f32>(v, u.mouseX, u.mouseY, glow));
    }
  `,
  
  // Render shader - Plasma coloring
  /* wgsl */`
    fn render(data: vec4<f32>, uv: vec2<f32>) -> vec4<f32> {
      let v = data.r;
      let mouseX = data.g;
      let mouseY = data.b;
      let glow = data.a;
      
      // Rainbow color palette
      let r = sin(v * 3.14159) * 0.5 + 0.5;
      let g = sin(v * 3.14159 + 2.094) * 0.5 + 0.5;
      let b = sin(v * 3.14159 + 4.188) * 0.5 + 0.5;
      
      var col = vec3<f32>(r, g, b);
      
      // Glow effect when mouse is pressed
      if (glow > 0.5) {
        let mousePos = vec2<f32>(mouseX, mouseY);
        let d = length(uv - mousePos);
        col += vec3<f32>(1.0, 0.8, 0.5) * exp(-d * 4.0) * 1.5;
      }
      
      // Slight vignette
      let vignette = 1.0 - length(uv - 0.5) * 0.4;
      col *= vignette;
      
      return vec4<f32>(col, 1.0);
    }
  `,
  { canvas: document.getElementById('c'), scale: 1.0 }
);

console.log('%c ğŸŒˆ mushu WebGPU Plasma Ready ', 'background: linear-gradient(90deg, #ff00ff, #00ffff); color: white; padding: 8px 16px; border-radius: 4px; font-weight: bold;');
console.log('Move mouse to influence colors. Click for glow effect!');
</script>
</body>
</html>
